% REQUIRED CMD-LINE PARAMS: $seeds, $nOfEvals

@import("imports/problem.txt")
@import("imports/listeners.txt")

$innerLayers = [2]
$weightsUpdateInterval = 1
$initialWeightRange = m.range(min = -0.1; max = 0.1)
$randomGenerator = m.sharedRG()

ea.experiment(
  runs = (randomGenerator = (seed = $seeds) * [m.defaultRG()])
  * (problem = [$problemHomoSame; $problemHomoDiff; $problemHetero])
  * (solver = (stop = ea.sc.nOfQualityEvaluations(n = $nOfEvals)) * [
    ea.s.ga(
      name = "mlp";
      representation = ea.representation.doubleString();
      mapper = ea.mapper.ndsToNrla(of = ea.mapper.dsToParametrized(parametrized = ds.num.mlp(innerLayers = $innerLayers)))
    );
    ea.s.ga(
      name = "hebbian+synapse+random";
      representation = ea.representation.doubleString();
      mapper = ea.mapper.ndsToNrla(of = ea.mapper.dsToParametrized(parametrized = ds.num.hebbianMlp(
        innerLayers = $innerLayers; 
        parametrizationType = synapse; 
        weightInitializationType = random; 
        weightsUpdateInterval = $weightsUpdateInterval; 
        initialWeightRange = $initialWeightRange;
        randomGenerator = $randomGenerator
        ))
      );
      remap = true
    );
    ea.s.ga(
      name = "hebbian+network+random";
      representation = ea.representation.doubleString();
      mapper = ea.mapper.ndsToNrla(of = ea.mapper.dsToParametrized(parametrized = ds.num.hebbianMlp(
        innerLayers = $innerLayers; 
        parametrizationType = network; 
        weightInitializationType = random; 
        weightsUpdateInterval = $weightsUpdateInterval; 
        initialWeightRange = $initialWeightRange;
        randomGenerator = $randomGenerator
        ))
      );
      remap = true
    );
    ea.s.ga(
      name = "freeForm+random";
      representation = ea.r.srTree(
        ephemeral = true;
        operators = [addition; subtraction; multiplication; prot_division; prot_log; max; min; tanh; gt; lt; ternary]
      );
      mapper = ea.mapper.parametrized(of = ea.mapper.srTreeToNurf(); parametrized = ds.rl.num.freeFormMlp(
        innerLayers = $innerLayers; 
        weightInitializationType = random; 
        weightsUpdateInterval = $weightsUpdateInterval; 
        initialWeightRange = $initialWeightRange;
        randomGenerator = $randomGenerator
        )
      );
      remap = true
    )
  ])
  * [ea.run()];
  listeners = [
    $console;
    $avgLastBoolScore;
    $increase;
    $consistency;
    $behaviorLastSeq;
    $trajsAfterFreeze
  ]
)