$basePath = ''./results/xor/local/{^^.name}/{^^.startTime}/''
$imgType = svg

$console = ea.l.console(
  eFunctions = [
    ea.f.size(of = ea.f.genotype(of = ea.f.best()); format = "%4d");
    f.mapValue(key = avgLastBoolScore; of = ea.f.quality(of = ea.f.best()); format = "%6.4f")
  ];
  kFunctions = [
    f.replaceAll(of = f.interpolated(name = numberOfInnerLayers; s = "{solver.mapper.of.parametrized.innerLayers}{solver.mapper.parametrized.innerLayers}"); regex="null")
  ];
  onlyLast = true
)

$avgLastBoolScore = ea.l.savePlotForExp(
  path = $basePath + "avgLastBoolScore." + $imgType;
  plot = ea.plot.multi.quality(
    q = f.mapValue(key = avgLastBoolScore)
  );
  type = $imgType
)

$increase = ea.l.savePlotForExp(
  path = $basePath + "increase." + $imgType;
  plot = ea.plot.multi.quality(
    q = f.mapValue(key = increase)
  );
  type = $imgType
)

$consistency = ea.l.savePlotForExp(
  path = $basePath + "consistency." + $imgType;
  plot = ea.plot.multi.quality(
    q = f.mapValue(key = consistency)
  );
  type = $imgType
)

$behaviorLastSeq = ea.l.saveForRun(
  path = $basePath + "{problem.name}-{solver.name}-{randomGenerator.seed:%02d}-behavior." + $imgType;
  of = ea.acc.lastBest();
  processor = viz.f.toImage(
    drawer = ds.d.sequentialXor(
      rewardTypes = [boolean]
    ); 
    of = ds.f.simulate(
      of = ea.f.solution();
      dT = 1;
      tRange = $tRange;
      simulation = ds.s.sequentialXor(
        cases = $testCases;
        rewardType = unlimited
      )
    );
    h = 2;
    type = $imgType
  )
)