$qFunctions = f.allNamed(fs = m.sKeyMap(
  keys = [behavior; avgLastBoolScore; increase; consistency];
  values = [
    f.identity();
    ds.e.sxor.avgScore(
      rewardType = boolean;
      caseIndexes = [360:1:399]   % last 40 cases
    );
    ds.e.sxor.avgScoreDelta(
      rewardType = unlimited;
      firstIndexes = [-10:1:-1];  % the last 40 cases
      secondIndexes = [0:1:1]     % the first 4 cases
    );
    ds.e.sxor.avgScoreVariation(
      rewardType = unlimited;
      indexes = [-8:1:-1]         % last 8 cases
    )
  ]
))

$testSim = ds.f.simulate(
  of = ds.f.asNumericalRLAgent(of = ds.f.stateless(of = ds.f.nonLearning()));
  dT = 1;
  tRange = $tRangeForFreeze;
  simulation = ds.s.sequentialXor(
    cases = $testCases;
    resetAgent = true;
    shuffle = true
  )
)

$learningSim = ds.f.simulate(
  name = "test-sim";
  dT = 1;
  tRange = $tRangeLife;
  simulation = ds.s.sequentialXor(
    cases = $cases;
    resetAgent = true;
    shuffle = true
  )
)

$problemFFF = ea.p.functionToTo(
  qFunction = f.namedMerged(
    mappers = [
      f.allNamed(
        of = $learningSim;
        fs = m.sKeyMap(
          keys = [behavior; avgLastBoolScore; increase; consistency];
          values = [
            f.identity();
            ds.e.sxor.avgScore(
              rewardType = boolean;
              caseIndexes = [360:1:399]   % last 40 cases
            );
            ds.e.sxor.avgScoreDelta(
              rewardType = unlimited;
              firstIndexes = [-10:1:-1];  % the last 40 cases
              secondIndexes = [0:1:1]     % the first 4 cases
            );
            ds.e.sxor.avgScoreVariation(
              rewardType = unlimited;
              indexes = [-8:1:-1]         % last 8 cases
            )
          ]
        )
      );
      f.allNamed(
        of = $testSim;
        fs = m.sKeyMap(
          keys = [frozenScore];
          values = [
            ds.e.sxor.avgScore(
              rewardType = boolean;
              caseIndexes = [0:1:3]
            )
          ]
        )
      )
    ]
  );
  cFunction = f.mapValue(key = frozenScore);
  type = maximize;
  example = ds.misc.simExample(
    simulation = ds.s.sequentialXor()
  )
)

$problem = ea.p.simToTo(
  name = "shuffled-cases";
  simulation = ds.s.sequentialXor(
    cases = $cases;
    rewardType = unlimited;
    resetAgent = true;
    shuffle = true
  );
  dT = 1;
  tRange = $tRangeLife;
  comparator = ea.comparator.descending(of = f.mapValue(key = avgLastBoolScore));
  qFunction = $qFunctions
)

$problemHomoSame = ea.p.simToTo(
  name = "homo-same";
  simulation = ds.s.sequentialXor(
    cases = $homoSameCases;
    rewardType = unlimited;
    resetAgent = true
  );
  dT = 1;
  tRange = $entireLifeLength;
  comparator = ea.comparator.descending(of = f.mapValue(key = avgLastBoolScore));
  qFunction = $qFunctions
)

$problemHomoDiff = ea.p.simToTo(
  name = "homo-diff";
  simulation = ds.s.sequentialXor(
    cases = $homoDiffCases;
    rewardType = unlimited;
    resetAgent = true
  );
  dT = 1;
  tRange = $entireLifeLength;
  comparator = ea.comparator.descending(of = f.mapValue(key = avgLastBoolScore));
  qFunction = $qFunctions
)

$problemHetero = ea.p.simToTo(
  name = "hetero";
  simulation = ds.s.sequentialXor(
    cases = $heteroCases;
    rewardType = unlimited;
    resetAgent = true
  );
  dT = 1;
  tRange = $entireLifeLength;
  comparator = ea.comparator.descending(of = f.mapValue(key = avgLastBoolScore));
  qFunction = $qFunctions
)